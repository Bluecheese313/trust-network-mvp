
<!DOCTYPE html>
<html>
<head>
  <title>Trust Network MVP</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 40px; }
    input, textarea, button { width: 100%; padding: 10px; margin-top: 10px; }
    #status { margin-top: 20px; color: green; }
  </style>
</head>
<body>
  <h2>ğŸ¯ Trust Network MVP (Base Sepolia)</h2>
  <button onclick="connectWallet()">ğŸ”— Káº¿t ná»‘i MetaMask</button>
  <p><strong>VÃ­ cá»§a báº¡n:</strong> <span id="walletAddress">ChÆ°a káº¿t ná»‘i</span></p>

  <h3>ğŸ“ Gá»­i Review</h3>
  <input type="number" id="score" placeholder="Äiá»ƒm (-10 Ä‘áº¿n 10)" min="-10" max="10" />
  <textarea id="comment" placeholder="Nháº­p bÃ¬nh luáº­n..."></textarea>
  <button onclick="submitReview()">ğŸ“¤ Gá»­i Review</button>

  <h3>ğŸ” Kiá»ƒm tra Reputation</h3>
  <input type="text" id="checkAddress" placeholder="Äá»‹a chá»‰ vÃ­ (0x...)" />
  <button onclick="getReputation()">ğŸ“Š Xem Reputation</button>
  <p id="reputationResult"></p>

  <div id="status"></div>

  <script>
    const contractAddress = "0x8b3FFAAc8CEbBC334142541a07ef3C9789a6Bd6F";
    const abi = [
      "function submitReview(int256 score, string comment) public",
      "function getReputation(address reviewer) public view returns (uint256)"
    ];

    let provider;
    let signer;
    let contract;

    async function connectWallet() {
      if (window.ethereum) {
        await window.ethereum.request({ method: "eth_requestAccounts" });
        provider = new ethers.BrowserProvider(window.ethereum);
        signer = await provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("walletAddress").innerText = address;
        contract = new ethers.Contract(contractAddress, abi, signer);
        document.getElementById("status").innerText = "âœ… ÄÃ£ káº¿t ná»‘i MetaMask!";
      } else {
        alert("Báº¡n cáº§n cÃ i MetaMask!");
      }
    }

    async function submitReview() {
      const score = parseInt(document.getElementById("score").value);
      const comment = document.getElementById("comment").value;
      if (!contract || isNaN(score)) return alert("Vui lÃ²ng nháº­p Ä‘Ãºng thÃ´ng tin");
      try {
        const tx = await contract.submitReview(score, comment);
        document.getElementById("status").innerText = "â³ Äang gá»­i giao dá»‹ch...";
        await tx.wait();
        document.getElementById("status").innerText = "âœ… Review Ä‘Ã£ Ä‘Æ°á»£c ghi onchain!";
      } catch (err) {
        document.getElementById("status").innerText = "âŒ Lá»—i: " + (err.reason || err.message);
      }
    }

    async function getReputation() {
      const addr = document.getElementById("checkAddress").value;
      if (!addr) return;
      try {
        const rep = await contract.getReputation(addr);
        document.getElementById("reputationResult").innerText = `Reputation cá»§a ${addr} lÃ : ${rep}`;
      } catch (err) {
        document.getElementById("reputationResult").innerText = "âŒ KhÃ´ng thá»ƒ truy váº¥n Ä‘á»‹a chá»‰.";
      }
    }
  </script>
</body>
</html>
